name: Build APK for Pico-4

on: [push]  # Собирать при каждом пуше

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Скачать код
    - name: Checkout code
      uses: actions/checkout@v3
      
    # 2. Установить Godot
    - name: Setup Godot
      run: |
        wget https://github.com/godotengine/godot/releases/download/4.2.1-stable/Godot_v4.2.1-stable_linux.x86_64
        chmod +x Godot_v4.2.1-stable_linux.x86_64
        mv Godot_v4.2.1-stable_linux.x86_64 godot
        
    # 3. Создать настройки экспорта
    - name: Create export preset
      run: |
        cat > export_presets.cfg << 'EOF'
        [preset.0]
        name="Android"
        platform="Android"
        runnable=true
        custom_template=""
        embedded_android_sdk=true
        architectures/arm64-v8a=true
        architectures/armeabi-v7a=false
        export_filter="all_resources"
        keystore/debug="user://android_debug.keystore"
        keystore/debug_user="androiddebugkey"
        keystore/debug_password="android"
        
        [preset.0.options]
        XR/OpenXR/Enabled=true
        XR/OpenXR/Form Factor="HMD"
        EOF
        
    # 4. Собрать APK
    - name: Build APK
      run: |
        ./godot --headless --export-release "Android" ball-game.apk
        
    # 5. Загрузить APK как артефакт
    - name: Upload APK
      uses: actions/upload-artifact@v4
      with:
        name: Ball-Game-APK
        path: ball-game.apk
        retention-days: 7
